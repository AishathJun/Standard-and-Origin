<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Standard & Origin Pvt Ltd</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favsno.png" rel="icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="fixed-top d-flex align-items-center">
    <div class="container">
      <div class="header-container d-flex align-items-center justify-content-between">
        <div class="logo">
          <!-- <h1 class="text-light"><a href="home.html"><span>Standard & Origin Pvt Ltd</span></a></h1> -->
          <!-- Uncomment below if you prefer to use an image logo -->
          <a href="home.html"><img src="assets/img/snologo.png" alt="S&O" class="img-fluid"></a>
        </div>

        <nav id="navbar" class="navbar">
          <ul>
            <li><a class="nav-link scrollto" href="home.html#hero">Home</a></li>
            <li><a class="nav-link scrollto" href="home.html#about">About Us</a></li>
            <li><a class="nav-item active" href="product-categories.html">Products</a></li>
            <li><a class="nav-item" href="outlets.html">Outlets</a></li>
            <li class="dropdown"><a href="#"><span>More</span> <i class="bi bi-chevron-down"></i></a>
              <ul>
                <li><a class="nav-item" href="newsletter.html">Newsletters</a></li>
                <li><a class="nav-item" href="recipes.html">Recipes</a></li>
              </ul>
            </li>
            <li><a class="nav-link scrollto" href="home.html#contact">Contact Us</a></li>

            <!-- FILTER ALL ITEMS -->
            <form class="" action="product-list.html" method="get">
              <li><a><input type="text" placeholder="Search.."  name="search" id="search">
                  <button class="search-items" id="search-item" >
                    <i class="bi bi-search"></i>
                  </button>
                  </a>
              </li>
              <div class="dropdown-content" id="search-dropdown">
		  <a href="#">Search all</a>
              </div>
            </form>
            <!-- END OF FILTER ALL ITEMS -->

          </ul>
          <i class="bi bi-list mobile-nav-toggle"></i>
        </nav><!-- .navbar -->

      </div><!-- End Header Container -->
    </div>
  </header><!-- End Header -->

  <main id="main">

    <!-- ======= Breadcrumbs ======= -->
    <section class="breadcrumbs">
      <div class="container">

        <div class="d-flex justify-content-between align-items-center">
          <h2>Product Type</h2>
          <ol>
            <li><a href="home.html">Home</a></li>
            <li><a href="product-categories.html">Categories</a></li>
            <li>Product Type</li>
          </ol>
        </div>

      </div>
    </section><!-- End Breadcrumbs -->

    <section class="inner-page">
      <div class="container">
        <!-- Search Bar -->
        <div class="search-container visible-xs visible-sm" id="product-search">
  				<form class="navbar-form navbar-right form" action="/" method="get">
  					<input type="text" class="form-control" name="prod-name" placeholder="Search..." value="" id="txt-search">
  					<br>
					<div id="select-brand-container">
					    <p>Loading</p>
					</div>
  				</form>
  			</div>

        <!-- ======= Products ======= -->
        <section id="prod-category" class="prod-category">
          <div class="container">
            <div class="row" id="product-container">


              <!--Show loading if data is not loaded-->
              <div class="spinner-border" role="status">
              </div>

            </div>
          </div>
        </section>
      </div>
    </section>

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="container d-md-flex py-4">
      <div class="me-md-auto text-center text-md-start">
        <div class="copyright">
          <p>Copyright &copy;<script>document.write(new Date().getFullYear());</script><strong><span> Standard & Origin Pvt Ltd</span></strong>.</p>
        </div>
      </div>
      <div class="social-links text-center text-md-right pt-3 pt-md-0">
        <a href="https://www.facebook.com/Standard-Origin-pvt-ltd-103054248182098" class="facebook"><i class="bx bxl-facebook"></i></a>
        <a href="https://www.instagram.com/sno.mv/" class="instagram"><i class="bx bxl-instagram"></i></a>
      </div>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/purecounter/purecounter.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

  <!--Provides some common functions to make the scripts more readable -->
  <script src="assets/js/api.utils.js"></script>

  <script>
    const category_id = getParam("category_id");
    const search_query = { search: getParam("search"), filter: getParam("filter")};
   const searchbar = document.getElementById("txt-search");
   const navsearchbar = document.getElementById("search");
   const productContainer = document.getElementById("product-container");
    var glob_product_list = [];


    const template = ({_id, name, url, brand, packaging, origin})=>`
              <div class="col-lg-4 col-md-6 mt-1" id=""> <!-- looping starts here -->
                <div class="icon-box" data-aos="zoom-in-left">
                  <h4 class="title" id="${_id}">${name}</a></h4>
                  <div class="icon-image">
                    <img id="prod-img" src="/${url}">
                  </div>
                  <br>
                  <div class="description">
                    <h7 id="prod-brand"><strong>Brand: </strong>${brand}</h7> <br>
                    <h7 id="prod-packing"><strong> Packing: </strong>${packaging}</h7> <br>
                    <!-- <h7 id="prod-packing"><strong> Price: </strong>MVR{40}</h7> <br> -->
                    <h7 id="prod-origin"><strong> Origin: </strong>${origin}</h7>
                  </div>
                </div>
              </div> <!-- looping ends here -->
`;
    const emptyTemplate = () => `<p>Sorry. No items available</p>`;

   const selectOptionTemplate = (brand_list)=>  ((option_str) => `
  	<select class="form-control" title="Brands" name="prod-brand" id="prod-brand" onchange="onSelectBrand()">
  	  <option value="" title="All Brands" selected="">-- All Brands --</option>
          ${option_str}
  	</select>
   `)(brand_list.map(brand=>`<option value="${brand.name}">${brand.name}</option>`).join(""));

    function redrawProductList(product_list){
        if(product_list.length == 0){
            productContainer.innerHTML = ""; //clear product container first
            productContainer.appendChild(createElement(emptyTemplate));
        } else{
            SNOAPI.populateContainer(productContainer, template)({data: product_list});
        }
    }

   /*
   function toggleSearchDropDown(dropdown){
       if(dropdown.style !== "block")
	   dropdown.style="block";
   }

   function glob_search(val){
       const dropdown = document.getElementById("search-dropdown");
       dropdown.toggle()
   }*/

    //["32131", "Hello World"] .map( e => e.toLowerCase().search("wo"))
    function search(val, extraFilter=()=>true){
        var product_list = glob_product_list;

        if(val.length != 0){
            product_list = glob_product_list.filter(e => {
		    const matchByName = e.name.toLowerCase().search(val.toLowerCase()) >= 0 ;
		    const matchByOrigin = e.origin.toLowerCase().search(val.toLowerCase()) >= 0;
		    const matchByBrand = e.brand.toLowerCase().search(val.toLowerCase()) >= 0;
		    const matchByPackaging = e.packaging.toLowerCase().search(val.toLowerCase()) >= 0;
                return matchByName || matchByOrigin || matchByBrand || matchByPackaging;
            });
        }
        redrawProductList(product_list.filter(extraFilter));
    }

   //attach search to keyboard event
    document.addEventListener('input', function(ev){
        const target_id = ev.target.id;
        if(target_id == "txt-search"){
            const val = ev.target.value;
            search(val);
        }

	/*
	if(target_id == "search"){
	    const val = ev.target.value;
	    glob_search(val);
	}*/
    });



   //filter items when brand is selected
   function onSelectBrand(){
       const brand_name = document.getElementById("prod-brand").value;
       const searchbar = document.getElementById("txt-search").value;
       categoryFilter = e => !e.brand.toLowerCase().search(brand_name.toLowerCase());
       search("", categoryFilter);
   }

    //if the url contains a valid category id
    if(category_id != null){
        SNOAPI.getProducts(
            results => {
                redrawProductList(results.data);
                glob_product_list = results.data;
            },
            {category_id}
        );

	SNOAPI.getBrandsByCategory(category_id, results => {
	    const el = selectOptionTemplate(results.data);
	    document.getElementById("select-brand-container").innerHTML = el;
	});
    }else if(search_query != null){
	//remove the select brand option
	document.getElementById("select-brand-container").innerHTML = "";
	//fetch products with search query
        SNOAPI.getProducts(
            results => {
                redrawProductList(results.data);
                glob_product_list = results.data;
            },
	    {...search_query}
        );
    }
  </script>
</body>

</html>
